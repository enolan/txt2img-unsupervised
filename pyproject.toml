[tool.poetry]
name = "txt2img-unsupervised"
version = "0.1.0"
description = ""
authors = ["Echo Nolan <echo@echonolan.net>"]
license = "BSD3"
readme = "README.md"

[tool.poetry.dependencies]
CloseableQueue-py3 = "^0.9.2"
dacite = "^1.8.1"
datasets = "^2.14.6"
einops = "^0.7.0"
flash-attention-jax = { git = "https://github.com/enolan/flash-attention-jax.git", rev = "20621388795614de137c159a5c07abec5c475388"}
flax = "^0.7.4"
imageio-ffmpeg = "^0.4.8"
infinidata = { url = "https://github.com/enolan/infinidata/releases/download/v0.0.1-alpha2/infinidata-0.0.1a2-cp311-cp311-manylinux_2_34_x86_64.whl" }
internetarchive = "^3.5.0"
omegaconf = "^2.3.0"
orbax-checkpoint = "^0.4.1"
pillow = "^9.5.0"
pytest = "^7.3.1"
python = "3.11.6"
pytorch-lightning = "^2.0.2"
sortedcontainers = "^2.4.0"
torch = {url = "https://download.pytorch.org/whl/cpu/torch-2.0.1%2Bcpu-cp311-cp311-linux_x86_64.whl"}
transformers = "^4.34.1"
wandb = "^0.15.12"
warcat = "^2.2.5"
xdg-base-dirs = "^6.0.1"

# Requires "poet-plugin" to get TPU libs on TPU VMs and CUDA libs on GPU machines
[tool.poetry.group.tpu.dependencies]
jax = {extras = ["tpu"], version = "^999.999.999"} # FIXME
jaxlib = {url = "https://files.pythonhosted.org/packages/75/c4/6c973f70031202f6eab43c632799228912ef5e539338257793d975fb63d0/jaxlib-0.4.18-cp311-cp311-manylinux2014_x86_64.whl"}

[tool.poetry.group.cuda.dependencies]
jax = {extras = ["cuda12_pip"], version = "0.4.23"}
jaxlib = {extras = ["cuda12_pip"], version = "0.4.23"}
nvidia-cudnn-cu12 = "8.9.4.25" # 8.9.5.29 is latest as of now (2023-10-19) but is for some fucking reason only has a windows wheel

[tool.poetry.group.dev.dependencies]
black = "^23.3.0"
flameprof = "^0.4"
hypothesis = {extras = ["numpy"], version = "^6.92.2"}
ipython = "^8.14.0"
matplotlib = "^3.7.1"
memray = "^1.11.0"
mypy = "^1.3.0"
types-pillow = "^9.5.0.4"
types-tqdm = "^4.65.0.1"


[[tool.poetry.source]]
name = "libtpu"
url = "https://storage.googleapis.com/jax-releases/libtpu_releases.html"
priority = "supplemental"


[[tool.poetry.source]]
name = "jaxlib-cuda"
url = "https://storage.googleapis.com/jax-releases/jax_cuda_releases.html"
priority = "supplemental"

[[tool.poetry.source]]
name = "PyPI"
priority = "primary"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
